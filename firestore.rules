rules_version = '2';
service cloud.firestore {

	match /databases/{database}/documents {

    function getRole(role){
      return request.auth != null && (get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == role)
    }

  	match /orders/{order} {
    	allow write: if getRole("EMPLOYEE");
      allow read: if request.auth != null;
    }
    match /menus/{menu} {
    	allow write: if getRole("RESTAURANT");
      allow read: if request.auth != null;
    }
    match /users/{user} {
    	allow read, write: if getRole("ADMIN");
    }
    match /users/{userId} {
    	allow read, update, delete: if (getRole("ADMIN") || request.auth.uid == userId);
      allow create: if getRole("ADMIN");
    }
  }
}